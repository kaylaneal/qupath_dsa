<?xml version = "1.0" encoding = "UTF-8"?>
<executable>

    <category>QuPath DSA</category>
    <title>Tissue Thresholder</title>
    <description>Detect tissue in a Whole-Slide Image (WSI)</description>
    <version>0.1.0</version>
    <contributor>Kayla Neal (Pearce Lab @ Pitt)</contributor>

    <parameters>

        <label>IO</label>
        <description>Input/Output Parameters</description>

        <image>
            <name>input_image</name>
            <label>Input Image</label>
            <description>Input image</description>
            <channel>input</channel>
            <index>0</index>
        </image>

        <region>
            <name>analysis_roi</name>
            <label>Analysis ROI</label>
            <description>Region of Interest (ROI) for analysis. Must be a 4 element vector in the format: (left, top, width, height). Default value is the entire image.</description>
            <longflag>analysis_roi</longflag>
            <default>-1,-1,-1,-1</default>
        </region>
      
        <file fileExtensions=".json" reference="input_image">
            <name>outputAnnotationFile</name>
            <label>Image Annotation File</label>
            <description>Annotation to relate the image to the source.</description>
            <channel>output</channel>
            <longflag>output_annotation</longflag>
        </file>

        <file fileExtensions=".json" reference="input_image">
            <name>outputItemMetadata</name>
            <label>Image Metadata File</label>
            <description>Image Metadata</description>
            <channel>output</channel>
            <longflag>output_metadata</longflag>
        </file>

    </parameters>

    <parameters>

        <label>Thresholder Model</label>
        <description>Tissue Thresholder Model Parameters</description>

        <double>
            <name>min_area</name>
            <label>Minimum Area</label>
            <description>Minium area of tissue to consider.</description>
            <channel>input</channel>
            <longflag>min_area</longflag>
            <default>0</default>
        </double>

        <double>
            <name>min_hole_area</name>
            <label>Minimum Hole Area</label>
            <description>Minium area of hole to consider.</description>
            <channel>input</channel>
            <longflag>min_hole_area</longflag>
            <default>0</default>        
        </double>

        <integer-enumeration>
            <name>downsample</name>
            <label>Downsample Factor</label>
            <description>Pixel downsample factor.</description>
            <channel>input</channel>
            <longflag>downsample</longflag>
            <element>8</element>
            <element>16</element>
            <element>32</element>
            <element>64</element>
            <default>16</default>      
        </integer-enumeration>        

        <string-enumeration>
            <name>channel</name>
            <label>Channel</label>
            <description>Image channel to apply thresholder on.</description>
            <channel>input</channel>
            <longflag>channel</longflag>
            <element>Red</element>
            <element>Green</element>
            <element>Blue</element>
            <element>Average</element>
            <default>Average</default>       
        </string-enumeration>

        <double>
            <name>threshold</name>
            <label>Threshold</label>
            <description>Pixel threshold value to determine if pixel represents tissue or background.</description>
            <channel>input</channel>
            <longflag>threshold</longflag>
            <default>220</default>        
        </double>

    </parameters>

</executable>